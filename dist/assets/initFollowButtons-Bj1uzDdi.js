import{g as i}from"./index-BD_VhrxQ.js";const c="https://v2.api.noroff.dev/social";async function u(n){const e=localStorage.getItem("accessToken")||i(),o=localStorage.getItem("apiKey");if(!e)return console.warn("⚠️ No token found — cannot fetch profile"),null;try{const t=await fetch(`${c}/profiles/${n}?_following=true`,{headers:{Authorization:`Bearer ${e}`,"X-Noroff-API-Key":`${o}`,"Content-Type":"application/json"}});return t.ok?(await t.json()).data:(console.warn(`❌ Failed to fetch profile for ${n}: ${t.status}`),null)}catch(t){return console.error("Error fetching profile with following:",t),null}}async function d(n){const e=localStorage.getItem("accessToken")||i(),o=localStorage.getItem("apiKey");if(!e)return console.warn("⚠️ No token found — cannot follow user"),!1;try{const t=await fetch(`${c}/profiles/${n}/follow`,{method:"PUT",headers:{Authorization:`Bearer ${e}`,"X-Noroff-API-Key":`${o}`,"Content-Type":"application/json"}});return t.ok?(console.log(`✅ Successfully followed ${n}`),!0):(console.warn(`❌ Follow failed for ${n}: ${t.status}`),!1)}catch(t){return console.error("Follow request failed:",t),!1}}function a(n,e="error",o=3e3){const t=document.createElement("div");t.textContent=n,t.style.position="fixed",t.style.bottom="75px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.padding="12px 20px",t.style.borderRadius="12px",t.style.color="white",t.style.fontSize="14px",t.style.fontWeight="500",t.style.boxShadow="0 4px 12px rgba(0,0,0,0.2)",t.style.zIndex="9999",t.style.opacity="0",t.style.transition="opacity 0.3s, transform 0.3s",e==="success"?t.style.backgroundColor="#4CAF50":e==="error"&&(t.style.backgroundColor="#F44336"),document.body.appendChild(t),requestAnimationFrame(()=>{t.style.opacity="1",t.style.transform="translateX(-50%) translateY(0)"}),setTimeout(()=>{t.style.opacity="0",t.style.transform="translateX(-50%) translateY(20px)",t.addEventListener("transitionend",()=>t.remove())},o)}async function y(){const n=document.querySelectorAll("[data-follow-btn]");for(const e of n){const o=e.getAttribute("data-username");if(o)try{const r=(await u(o))?.isFollowing||!1;e.dataset.followed=r.toString(),e.textContent=r?"Following":"Follow"}catch(t){console.warn(`Could not check follow status for ${o}`,t)}}document.addEventListener("click",async e=>{const o=e.target?.closest("[data-follow-btn]");if(!o)return;const t=o.getAttribute("data-username");if(!t)return;if(o.dataset.followed==="true"){a("You are already following this profile");return}o.disabled=!0,o.textContent="Following…";try{if(await d(t)){o.dataset.followed="true",o.textContent="Following";const l=document.querySelector("[data-followers-count]");if(l){const f=parseInt(l.textContent||"0",10);l.textContent=(f+1).toString()}}else o.textContent="Error",a("You are already following this profile"),setTimeout(()=>{o.textContent="Follow"},1500)}catch(s){console.error("Follow failed:",s);const l=s?.message||"Something went wrong while trying to follow";a(l),o.textContent="Error"}finally{o.disabled=!1}})}export{y as initFollowButtons};
